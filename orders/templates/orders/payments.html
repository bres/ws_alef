{% extends 'base.html' %}
{% block title %}cart{% endblock %}
{% load static %}
{% block content %}

<section class="pt-10 bg-gray-50 min-h-screen z-0">
  <div class="container mx-auto px-4">



    <div class="p-8 lg:p-10 bg-white shadow border border-gray-200 rounded-md">
      <h2 class="mb-12 text-4xl font-bold font-heading">Review Your Order And Procced To Payment</h2>

       <div class="flex flex-wrap ">
        <div class="w-full xl:w-8/12 mb-8 xl:mb-0 px-4">
          <div class="w-full space-y-10 text-black ">
            <div class="shadow border border-gray-200">
            <h2 class="text-xl font-bold px-4 py-2 border-b border-gray-300 tracking-wide">Billing Address</h2>
            <p class="text-gray-700 px-4 py-1 capitalize">{{ order.full_name }}</p>
            <p class="text-gray-700 px-4 py-1 ">{{ order.email }}</p>
            <p class="text-gray-700 px-4 py-1 capitalize">{{ order.phone }}</p>
            <p class="text-gray-700 px-4 py-1 capitalize">{{ order.address }}, {{ order.post_code }}</p>
            <p class="text-gray-700 px-4 py-1 capitalize">{{ order.municipality }}, {{ order.state }}</p>
            <p class="text-gray-700 px-4 py-1 capitalize">{{ order.city }}, {{ order.country }}</p>
            {% if order.order_note %}
            <p class="block px-4 py-2 capitalize border-t font-bold tracking-wide">Note : <span class="font-medium">{{ order.order_note }}</span></p>
             {% endif %}

            </div>
            <div class="shadow border border-gray-200">
            <h2 class="text-xl font-bold px-4 py-2 border-b border-gray-300 tracking-wide">Payment Method</h2>
            <p class="text-gray-700 px-4 py-4">This is my cool new card!</p>
            </div>
            <div class="shadow border border-gray-200">
            <h2 class="text-xl font-bold px-4 py-2 border-b border-gray-300 tracking-wide">Review Products</h2>
            <table class="w-full border-collapse bg-black">
              <thead>
                <tr class="border-b-2 border-gray-200">
                  <th class="px-2 sm:px-4 py-3 text-left text-xs font-semibold text-white uppercase ">
                  </th>
                  <th class="px-2 sm:px-4 py-3 text-center text-xs font-semibold text-white uppercase ">
                    quantity
                  </th>

                  <th class=" px-2 sm:px-4 py-3 text-center text-xs font-semibold text-white uppercase" >
                    total price
                  </th>

                </tr>
              </thead>
              <tbody>

                {% for cart_item in cart_items %}
                <tr class="bg-white">
                  <td class="px-2 sm:px-4 py-5 text-sm">
                    <div class="flex ">
                      <div class="flex-shrink-0 w-24 h-24 sm:w-40 sm:h-40">
                        <img class="w-full h-full" src="{{ cart_item.product.images.url }}" alt="" />
                      </div>
                      <div class="flex flex-1 flex-col ml-3">
                        <a href="{{ cart_item.product.get_url }}" class="text-gray-900 capitalize">
                          {{cart_item.product.product_name}}
                        </a>
                        <p class="text-gray-900 capitalize">
                          {% if cart_item.variations.all %}
                          {% for item in cart_item.variations.all %}
                              {{item.variation_category }} : {{ item.variation_value }}<br>
                          {% endfor %}
                        {% endif %}
                        </p>
                        <small class="text-gray-900 flex flex-1 items-end">
                          In stock
                        </small>
                      </div>
                    </div>
                  </td>
                  <td class="px-2 sm:px-4 py-5 text-sm  text-center ">
                      <p class="px-2 py-2">{{ cart_item.quantity }}</p>
                  </td>

                  <td class="px-2 sm:px-4 py-5  text-center  text-md">
                    <p class="text-gray-900">
                      €{{ cart_item.sub_total }}
                    </p>
                  </td>

                </tr>
                {% endfor %}

              </tbody>
            </table>
             </div>
          </div>
        </div>

        <div class="w-full xl:w-4/12 px-2">
          <div class="p-6 md:p-8 bg-gray-100 border border-gray-200 shadow">
            <h2 class="mb-4 text-3xl font-semibold capitalize text-gray-900">Cart totals</h2>
            <div class="flex mb-4 items-center justify-between pb-4 border-b border-gray-300">
              <span class="text-gray-700">Subtotal <small>( Includes V.A.T )</small></span>
              <span class="text-xl font-medium capitalize text-gray-900">€{{ total }}</span>
            </div>
            <h4 class="mb-2 text-xl font-medium capitalize text-gray-900">Shipping</h4>
            <div class="flex mb-2 justify-between items-center">
              <span class="text-gray-700">Greece </span>
               <span class="text-xl font-medium capitalize text-gray-900">Free Shipping</span>
            </div>
            <!-- <div class="flex mb-10 justify-between items-center">
              <span class="text-gray-700">From store</span>
              <span class="text-xl font-medium capitalize text-gray-900">Free</span>
            </div> -->
            <div class="flex mb-10 justify-between items-center">
              <span class="text-xl font-medium capitalize text-gray-900">Order total <small>( Includes V.A.T )</small> </span>
              <span class="text-xl font-medium capitalize text-gray-900">€{{ grand_total }}</span>
            </div>
            <!-- Set up a container element for the button -->
            <div id="paypal-button-container" class="paypal">
              <!-- paypal button -->
            </div>


          </div>
        </div>
      </div>
    </div>

  </div>
</section>

<script>
         var amount = {{ grand_total }}

        // Render the PayPal button into #paypal-button-container
        paypal.Buttons({

            // Set up the transaction
            createOrder: function(data, actions) {
                return actions.order.create({
                    purchase_units: [{
                        amount: {
                            value: amount,
                        }
                    }]
                });
            },

            // Finalize the transaction
            onApprove: function(data, actions) {
                return actions.order.capture().then(function(orderData) {
                    // Successful capture! For demo purposes:
                    console.log('Capture result', orderData, JSON.stringify(orderData, null, 2));
                    var transaction = orderData.purchase_units[0].payments.captures[0];
                    //console.log(details);
                    alert('Transaction '+ transaction.status + ': ' + transaction.id + '\n\nSee console for all available details');

                    // Replace the above to show a success message within this page, e.g.
                     const element = document.getElementById('paypal-button-container');
                     element.innerHTML = '';
                     element.innerHTML = '<h3>Thank you for your payment!</h3>';
                    // Or go to another URL:  actions.redirect('thank_you.html');
                });
            }


        }).render('#paypal-button-container');
    </script>


{% endblock %}
